{% extends "base.html" %}
{% load static %}

{% block title %}Home - My Untold Stories{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
  <link rel="stylesheet" href="{% static 'css/header.css' %}">
  <link rel="stylesheet" href="{% static 'css/footer.css' %}">
{% endblock %}

{% block header %}
  {% include 'partials/header.html' %}
{% endblock %}

{% block content %}
<main class="homepage">
  {% if not user.is_authenticated %}
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>Welcome to My Untold Stories</h1>
      <p>Discover immersive experiences, timeless narratives, and magical artifacts from history and fiction.</p>
      <a href="{% url 'product_list' %}" class="btn-primary">Explore the Store</a>
    </div>
    <div class="hero-image">
      <img src="{% static 'img/hero_img.png' %}" alt="Hero banner">
    </div>
  </section>

  <!-- Features Section -->
  <section class="features">
    <h2>Why Choose Us</h2>
    <div class="feature-grid">
      <div class="feature-item">
        <i class="fa-solid fa-trophy fa-4x"></i>
        <h3>Premium Quality</h3>
        <p>Every product is crafted with care and historical accuracy.</p>
      </div>
      <div class="feature-item">
        <i class="fa-solid fa-book fa-4x"></i>
        <h3>Immersive Storytelling</h3>
        <p>Each item comes with a rich backstory that brings it to life.</p>
      </div>
      <div class="feature-item">
        <i class="fa-solid fa-person fa-4x"></i>
        <h3>Accessible Design</h3>
        <p>We prioritize inclusive experiences for all users.</p>
      </div>
    </div>
  </section>

  <!-- Featured Products -->
  <section class="featured-products">
    <h2>Featured Artifacts</h2>
    <div class="product-grid">
      {% for product in featured_products %}
        <div class="product-card">
          <img src="{{ product.image.url }}" alt="{{ product.name }}">
          <h3>{{ product.name }}</h3>
          <p>{{ product.short_description }}</p>
          <a href="{% url 'product_detail' product.pk %}" class="btn-secondary">View Details</a>
        </div>
      {% empty %}
        <p>No featured products available at the moment.</p>
      {% endfor %}
    </div>
  </section>

  <!-- Testimonials -->
  <section class="testimonials">
    <h2>What Our Customers Say</h2>
    <div class="testimonial-slider">
    {% for testimonial in testimonials %}
      <div class="testimonial">
        <blockquote>{{ testimonial.quote }}</blockquote>
        <p><strong>{{ testimonial.name }}</strong>{% if testimonial.role %}, {{ testimonial.role }}{% endif %}</p>
        {% if testimonial.image %}
          <img src="{{ testimonial.image.url }}" alt="{{ testimonial.name }}">
        {% endif %}
      </div>
    {% empty %}
      <p>No testimonials yet.</p>
    {% endfor %}
    </div>
  </section>

  <!-- Newsletter Signup -->
<section class="newsletter">
  <h2>Stay in the Loop</h2>
  <p>Sign up to receive updates, exclusive offers, and behind-the-scenes stories.</p>

  <form id="newsletter-form"
    action="https://script.google.com/macros/s/AKfycbzdww5XbeCEI9IsAjofUkW29Hcf4ZlVKHWr5j37f9g2bO3WqI04Oh2VhUUcX0-RRkiGcg/exec"
    method="post">
    {% csrf_token %}
    <input type="email" name="email" placeholder="you@example.com" required>
    <button type="submit" class="btn-primary">Subscribe</button>
  </form>

  <div id="newsletter-confirmation" class="hidden" role="status" aria-live="polite">
    <p>Thanks for subscribing! Youâ€™re officially in the loop.</p>
  </div>
  {% else %}
  <h2>Future content will be arriving here soon</h2>
  {% endif %}
</section>

</main>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("newsletter-form");
  const confirmation = document.getElementById("newsletter-confirmation");
  const submitButton = form.querySelector("button[type='submit']");

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    // Show loading state
    submitButton.disabled = true;
    submitButton.textContent = "Subscribing...";

    const formData = new FormData(form);

    fetch(form.action, {
      method: "POST",
      body: formData
    })
    .then(response => {
      if (!response.ok) throw new Error("Network error");
      return response.text();
    })
    .then(() => {
      form.style.display = "none";
      confirmation.classList.remove("hidden");
    })
    .catch(error => {
      console.error("Newsletter signup failed:", error);
      submitButton.disabled = false;
      submitButton.textContent = "Subscribe";
      alert("Oops! Something went wrong. Please try again.");
    });
  });
});
</script>
{% endblock %}

{% block footer %}
  {% include 'partials/footer.html' %}
{% endblock %}